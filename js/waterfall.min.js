var Waterfall=function(o){var o=o||{};this.obody=o.obody,this.layout=o.layout,this.top=o.top,this.left=o.left,this.heightMode=o.heightMode,this.init()};Waterfall.prototype={init:function(){var o=this;o.topArr=[],o.minObj=null,o.minindex=null,o.maxObj=null,o.count=0,o._start(),o._resize()},_start:function(){var o=this;o._width=(o.obody.width()-(o.layout-1)*o.left)/o.layout,o.obody.children().width(o._width);for(var t=0,i=o.obody.children().length;i>t;t+=1)o.obody.children().eq(t).find("img")[0].complete?(o.count+=1,o.count==o.obody.children().length&&o.setTop()):o.obody.children().eq(t).find("img").on("load",function(){o.count+=1,o.count==o.obody.children().length&&o.setTop()})},setTop:function(){for(var o=this,t=o.left,i=0,e=o.obody.children().length;e>i;i+=1)if(o.minObj=o.topArr[0],o.minindex=0,i<o.layout){var n={obj:o.obody.children().eq(i),height:o.obody.children().eq(i).height()+o.top};o.topArr.push(n),o.obody.children().eq(i).css({top:o.top,left:i*o.obody.children().width()+i*t})}else{if(o.heightMode)for(var h=0,r=o.topArr.length;r>h;h+=1)!function(t){o.topArr[t].height<o.minObj.height&&(o.minObj=o.topArr[t],o.minindex=t)}(h);o.obody.children().eq(i).css({top:o.minObj.height+o.top,left:o.minObj.obj.css("left")});var d={obj:o.obody.children().eq(i),height:o.obody.children().eq(i).position().top+o.obody.children().eq(i).height()};o.topArr.splice(o.minindex,1),o.topArr.push(d)}if(o.topArr&&o.topArr.length>0){o.maxObj=o.topArr[0];for(var i=0,e=o.topArr.length;e>i;i+=1)o.topArr[i].height>o.maxObj.height&&(o.maxObj=o.topArr[i]);o.obody.css("height",o.maxObj.height)}},_resize:function(){var o=this;$(window).on("resize",function(){o.setTop()})}};